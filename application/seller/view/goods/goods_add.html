<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>产品发布</title>
    <link rel="stylesheet" href="/static/12/admin/css/layui.css" media="all"/>
    <link rel="stylesheet" href="/static/12/admin/css/font-awesome.min.css" media="all"/>
    <script src="/static/12/admin/js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="/static/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/static/ueditor/ueditor.all.min.js"> </script>
    <script type="text/javascript" charset="utf-8" src="/static/ueditor/lang/zh-cn/zh-cn.js"></script>
    <style type="text/css">
        .layui-upload{
            margin-left:34px;
        }
    </style>
</head>

<body>
    <div class="layui-fluid">
        <form class="layui-form" name="frm" action="" lay-filter="component-form-element">
        <div class="layui-form-item">
              <div class="layui-row layui-col-space10 layui-form-item">
                <div class="layui-card layui-form" lay-filter="component-form-element">
                  <div class="layui-card-header">请选择分类</div>
                  <div class="layui-card-body layui-row layui-col-space10">
                    <div class="layui-col-md6">
                      <select name="tr_id" lay-verify="">
                        <option value="">请选择行业</option>
                        <option value="1">金融</option>
                        <option value="2">餐饮</option>
                        <option value="3">商城</option>
                      </select>
                    </div>
                    <div class="layui-col-md6">
                      <select name="la_id" lay-verify="">
                        <option value="">请选择开发语言</option>
                        <option value="1">PHP</option>
                        <option value="2">java</option>
                      </select> 
                    </div>
                    <div class="layui-col-md6" >
                      　　<div class="layui-card-header">接口类型</div>
                      <div class="layui-card-body layui-row layui-col-space10">
                        <div class="layui-col-md12">
                            <input type="checkbox" name="ln_id[]" value="1" title="android" lay-skin="primary" checked>
                            <input type="checkbox" name="ln_id[]" value="2" title="ios" lay-skin="primary">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="layui-card layui-form" lay-filter="component-form-element">
                  <div class="layui-card-header">产品类型：</div>
                      <div class="layui-card-body layui-row layui-col-space10">
                        <div class="layui-col-md12">
                          <input type="radio" name="type" value="1" title="成品" checked>
                          <input type="radio" name="type" value="2" title="定制">
                        </div>
                      </div>
                    </div>
                </div>
                <div class="layui-card layui-form" lay-filter="component-form-element">
                  <div class="layui-card-header">可否试用：</div>
                      <div class="layui-card-body layui-row layui-col-space10">
                        <div class="layui-col-md12">
                          <input type="radio" name="trial" value="1" title="可试用" checked>
                          <input type="radio" name="trial" value="2" title="不可试用">
                        </div>
                      </div>
                    </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">产品名称:</label>
                    <div class="layui-input-inline">
                      <input type="text" name="g_name" placeholder="请输入产品名称" autocomplete="off" class="layui-input">
                    </div>
                    <label class="layui-form-label">产品价格:</label>
                    <div class="layui-input-inline" style="width: 80px;">
                      <input type="text" name="price" lay-verify="number" value="" class="layui-input">
                    </div>
                    <div class="layui-form-mid">元</div>
                </div>
                <div class="layui-col-md6">
                    <div class="layui-row layui-col-space10">
                        <div class="layui-col-md6">
                            <div class="layui-card-header">产品图片:</div>
                            <div class="layui-upload">
                              <!-- <input type="file" name="file" id="s_pmt_dw" style="width:190px;"> -->
                              <button type="button" name="url" class="layui-btn" id="test1">上传图片</button>
                            </div>
                        </div>
                 <div class="layui-col-md6">
                    <div class="layui-upload-list" id="#demo2">
                            <img class="layui-upload-img" id="demo1" style="width: 250px;height: 250px">
                            <p id="demoText"></p>
                            <input type="hidden" name="p_id" id="pid" value="">
                    </div> 
                </div>
                    </div>
                </div> 
              </div>
                <div class="layui-form-item" id="comment">
                    <div class="layui-card-header">产品描述：</div>
                    <div class="layui-input-block">
                        <script id="editor" type="text/plain"  name="descr" style="width:1500px;height:400px;"></script>
                        <!--<script id="editor" type="text/plain" style="width:1024px;height:500px;"></script>-->
                        <!--<textarea id="credit" name="content" style="display: none;"></textarea>-->
                    </div>
                </div>
              <div class="layui-form-item">
                <div class="layui-input-block">
                  <button class="layui-btn submit" lay-submit lay-filter="component-form-element">立即提交</button>
                  <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
              </div>
             </div>
            </form>
  <script src="/static/layui/layui.js"></script>
            <script type="text/javascript">
              var editor = new baidu.editor.ui.Editor({
                initialContent: ''
              });
              editor.render("editor");



                $(document).on('click','.submit',function () {
                  descr = editor.getContent();
                  var data = $('[name=frm]').serializeArray();
                  data.push({"name":"descr","value":descr});
                    $.post('/admin/goods/goods_add.html',data, function (data) {
                        if (data.status == 1) {
                            layer.alert(data.info);
                        } else {
                            var msg = '未授权访问';
                            if (data.info) {
                                msg = data.info;
                            }
                            layer.alert(msg);
                        }
                    },'json');
                });
                var layer, form;
layui.use(['layer', 'form', 'element','upload'], function () {
    admin = layui.admin
    ,element = layui.element
    ,form = layui.form;
    var $ = layui.jquery
    ,upload = layui.upload;
  
  //普通图片上传
  var uploadInst = upload.render({
    elem: '#test1'
    ,url: '/admin/goods/upload.html'
    ,before: function(obj){
      //预读本地文件示例，不支持ie8
      obj.preview(function(index, file, result){
        $('#demo1').attr('src', result); //图片链接（base64）
      });
    }
    ,done: function(res){
      //如果上传失败
      if(res.code != 1){
        return layer.msg('上传失败');
      }
      //上传成功
      $('#pid').val(res.id);
    }
    ,error: function(){
      //演示失败状态，并实现重传
      var demoText = $('#demoText');
      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
      demoText.find('.demo-reload').on('click', function(){
        uploadInst.upload();
      });
    }
  });
    // //选完文件后不自动上传（js代码，将文件传到后台）
    //         var uploadInst = upload.render({
    //          elem: '#test1'     /*根据绑定id，打开本地图片*/
    //         ,url: '/admin/goods/upload.html'  /*上传后台接受接口*/
    //         ,auto: false        /*true为选中图片直接提交，false为不提交根据bindAction属性上的id提交*/
    //         ,bindAction: '.submit'   /*提交图片*/
    //         ,choose:function(obj){
    //             //预读本地文件示例，不支持ie8
    //             obj.preview(function(index, file, result){
    //               $('#demo1').attr('src', result); //图片链接（base64）
    //             });
    //           }
    //         ,before: function(obj){
    //             id = $('#test1').arrt('data-id');
    //             alert(id);
    //            this.data={'id':id};//关键代码
    //         } 
    //         ,done: function(res){
    //           console.log(res)
    //         }
    //       });
          

    

    form.render(null, 'component-form-element');
    element.render('breadcrumb', 'breadcrumb');
    
    form.on('submit(component-form-element)', function(data){
      layer.msg(JSON.stringify(data.field));
      return false;
    });
  });
            </script>
    </div>
  </div>

  
  
<script>

  </script>
</body>
</html>